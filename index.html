<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>Hanabi</title>
<link rel="stylesheet" type="text/css" href="static/style.css" />

<script src="http://yui.yahooapis.com/3.11.0/build/yui/yui-min.js"></script>
<script src="/static/jquery-2.0.3.js"></script>
<script src="/static/jquery.cookie.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    var socket = io.connect('http://localhost:3000');

    socket.on('connect', function (data) {
        socket.emit('routeMe', $.cookie('game_session'));
    });

    socket.on('setGameSessionCookie', function (data) {
        $.cookie('game_session', data, { expires: 7});
    });

    socket.on('clearGameSessionCookie', function (data) {
        $.removeCookie('game_session');
    });


    // Position game board elements based on count of players and current window size
    // Called whenever the window is resized
    var layout = function (playerCount) {
        var makePlayer = function (Y, name, vertical) {
            var newPlayer = Y.Node.create('<div class="player" id="' + name + '" />');
            newPlayer.appendChild(Y.Node.create('<div id="' + name + '_slot1"></div>'));
            newPlayer.appendChild(Y.Node.create('<div id="' + name + '_slot2"></div>'));
            newPlayer.appendChild(Y.Node.create('<div id="' + name + '_slot3"></div>'));
            newPlayer.appendChild(Y.Node.create('<div id="' + name + '_slot4"></div>'));
            newPlayer.appendChild(Y.Node.create('<div id="' + name + '_slot5"></div>'));
            newPlayer.all('div').addClass('slot');
            if (vertical) {
                newPlayer.all('div').addClass('vertical');
            }
            return newPlayer;
        };

        var makeFireworks = function (Y) {
            var fireworks = Y.Node.create('<div class="fireworks" />');
            fireworks.appendChild(Y.Node.create('<div id="firework_red"></div>'));
            fireworks.appendChild(Y.Node.create('<div id="firework_blue"></div>'));
            fireworks.appendChild(Y.Node.create('<div id="firework_green"></div>'));
            fireworks.appendChild(Y.Node.create('<div id="firework_yellow"></div>'));
            fireworks.appendChild(Y.Node.create('<div id="firework_white"></div>'));
            fireworks.all('div').addClass('slot');
            return fireworks;
        };

        var makeClueTokens = function (Y) {
            var clues = Y.Node.create('<div class="clues" />');
            var i;
            for (i = 0; i < 9; i++) {
                if ((i % 3) === 0) {
                    clues.appendChild(Y.Node.create('<div class="clue token endline" />'));
                } else {
                    clues.appendChild(Y.Node.create('<div class="clue token" />'));
                }
            }
            return clues;
        };

        var makeLifeTokens = function (Y) {
            var lives = Y.Node.create('<div class="lives" />');
            lives.appendChild(Y.Node.create('<div class="life token" />'));
            lives.appendChild(Y.Node.create('<div class="life token" />'));
            lives.appendChild(Y.Node.create('<div class="life token" />'));
            return lives;
        };

        var makeDrawPile = function (Y) {
            var draw = Y.Node.create('<div id="draw" class="slot" />');
            return draw;
        };

        var makeDiscardPile = function (Y) {
            var discard = Y.Node.create('<div id="discard" class="slot" />');
            return discard;
        };

        YUI().use('node', function (Y) {
            var width = $(window).width();
            var height = $(window).height();

            var gameboard = Y.one('#gameboard');

            var player1 = makePlayer(Y, 'player1', true);
            gameboard.appendChild(player1);
            player1.setY(height / 2 - parseInt(player1.getComputedStyle('height'), 10) / 2);
            var player2 = makePlayer(Y, 'player1');
            gameboard.appendChild(player2);
            var fireworks = makeFireworks(Y);
            gameboard.appendChild(fireworks);
            var clues = makeClueTokens(Y);
            gameboard.appendChild(clues);
            var lives = makeLifeTokens(Y);
            gameboard.appendChild(lives);
            var draw = makeDrawPile(Y);
            gameboard.appendChild(draw);
            var discard = makeDiscardPile(Y);
            gameboard.appendChild(discard);

            // Set size of cards/slots relative to screen size
            var tileSize = Math.min(width/8, height/8);

            gameboard.all('div.slot').setStyles({'width': tileSize + 'px', 'height': tileSize + 'px'});;

            
        });

        YUI().use('event-resize', function (Y) {
            Y.on('windowresize', layout);
        });
    };

    layout();
</script>

</head>
<body>

<div id="splash">
    <div class="yui3-widget-hd">Hanabi</div>
    <div class="yui3-widget-bd">
        <form>
            <button id="new_game">New Game</button>
            <button id="join_game">Join Game</button>
        </form>
    </div>
    <div class="yui3-widget-ft"></div>
</div>

<div id="new_game">
    <div class="yui3-widget-hd">New Game</div>
    <div class="yui3-widget-bd">
        <form>
            <input type="text" id="new_game_name" />
            <input type="text" id="new_game_password" />
            <button id="new_game_cancel">Cancel</button>
            <button id="new_game_create">Create Game</button>
        </form>
    </div>
    <div class="yui3-widget-ft"></div>
<h1>New Game</h1>
</div>

<div id="game_list">
    <div class="yui3-widget-hd">Games in progress</div>
    <div class="yui3-widget-bd">
        List of games...
        <form>
            <button id="game_list_cancel">Cancel</button>
            <button id="game_list_join">Join</button>
        </form>
    </div>
    <div class="yui3-widget-ft"></div>
</div>

<div id="password">
    <div class="yui3-widget-hd">Password required</div>
    <div class="yui3-widget-bd">
        <form>
            <input type="text" />
            <button id="password_cancel">Cancel</button>
            <button id="password_enter">Submit</button>
        </form>
    </div>
    <div class="yui3-widget-ft"></div>
</div>

<div class="gameboard" id="gameboard">

    <!--<div class="card red" id="c1">1</div>
    <div class="card blue" id="c2">2</div>
    <div class="card green" id="c3">3</div>
    <div class="card yellow" id="c4">4</div>
    <div class="card white" id="c5">5</div>-->

</div>
</body>
</html>
